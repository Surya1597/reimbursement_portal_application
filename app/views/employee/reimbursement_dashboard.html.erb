<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">My Reimbursement Dashboard</h2>
      <% if @employee_profile.present? %>
        <p class="text-muted mb-0">
          <strong><%= @employee_profile.first_name %> <%= @employee_profile.last_name %></strong>
          <% if @employee_profile.designation.present? %>
            · <%= @employee_profile.designation.titleize %>
          <% end %>
          <% if @employee_profile.department.present? %>
            · <%= @employee_profile.department.name %>
          <% end %>
        </p>
      <% end %>
    </div>

    <%= link_to "Submit New Bill",
                new_bill_path,
                class: "btn btn-primary" %>
  </div>

  <% if @bills.any? %>

    <!-- Summary cards -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-5 g-3 mb-4">
      <div class="col">
        <div class="card text-center h-100">
          <div class="card-body">
            <h6 class="text-muted text-uppercase mb-2">Total Bills</h6>
            <h3 class="mb-0"><%= @total_bills %></h3>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card text-center h-100">
          <div class="card-body">
            <h6 class="text-muted text-uppercase mb-2">Approved</h6>
            <h3 class="mb-1"><%= @approved_bills %></h3>
            <p class="text-muted mb-0">
              <small>₹<%= @approved_amount %></small>
            </p>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card text-center h-100">
          <div class="card-body">
            <h6 class="text-muted text-uppercase mb-2">Pending</h6>
            <h3 class="mb-1"><%= @pending_bills %></h3>
            <p class="text-muted mb-0">
              <small>₹<%= @pending_amount %></small>
            </p>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card text-center h-100">
          <div class="card-body">
            <h6 class="text-muted text-uppercase mb-2">Rejected</h6>
            <h3 class="mb-1"><%= @rejected_bills %></h3>
            <p class="text-muted mb-0">
              <small>₹<%= @rejected_amount %></small>
            </p>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card text-center h-100">
          <div class="card-body">
            <h6 class="text-muted text-uppercase mb-2">Total Amount Requested</h6>
            <h3 class="mb-0">₹<%= @total_amount %></h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Bills table -->
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Submitted Bills</span>
        <div class="btn-group btn-group-sm" role="group">
          <button type="button" class="btn btn-outline-secondary active" data-filter="all">
            All
          </button>
          <button type="button" class="btn btn-outline-secondary" data-filter="approved">
            Approved
          </button>
          <button type="button" class="btn btn-outline-secondary" data-filter="pending">
            Pending
          </button>
          <button type="button" class="btn btn-outline-secondary" data-filter="rejected">
            Rejected
          </button>
        </div>
      </div>

      <div class="card-body p-0">
        <table class="table table-hover mb-0" id="bills-table">
          <thead class="thead-light">
            <tr>
              <th>#</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Submitted On</th>
              <th>Reviewed By</th>
              <th>Reviewed At</th>
            </tr>
          </thead>
          <tbody>
            <% @bills.order(created_at: :desc).each_with_index do |bill, index| %>
              <tr data-status="<%= bill.status %>">
                <td><%= index + 1 %></td>
                <td><%= bill.bill_type || bill.type %></td>
                <td>₹<%= bill.amount %></td>
                <td>
                  <% status = bill.status.to_s %>
                  <% text_class =
                       case status
                       when "approved" then "text-success"
                       when "pending"  then "text-warning"
                       when "rejected" then "text-danger"
                       else "text-secondary"
                       end %>
                  <strong>
                    <span class="<%= text_class %> text-capitalize">
                        <%= status %>
                    </span>
                  </strong>
                </td>
                <td><%= bill.created_at.strftime("%d %b %Y, %I:%M %p") %></td>
                <td><%= bill.reviewed_by&.name || "—" %></td>
                <td>
                  <% if bill.reviewed_at.present? %>
                    <%= bill.reviewed_at.strftime("%d %b %Y, %I:%M %p") %>
                  <% else %>
                    —
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% else %>
    <!-- Empty state -->
    <div class="card text-center">
      <div class="card-body py-5">
        <h4 class="mb-3">No bills submitted yet</h4>
        <p class="text-muted mb-4">
          You haven’t submitted any reimbursement bills. Click the button below to create your first bill.
        </p>
        <%= link_to "Submit Your First Bill",
                    new_bill_path,
                    class: "btn btn-primary btn-lg" %>
      </div>
    </div>
  <% end %>
</div>

<%# Simple client-side filter by status using Bootstrap + a tiny bit of JS %>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var buttons = document.querySelectorAll("[data-filter]");
    var rows    = document.querySelectorAll("#bills-table tbody tr");

    buttons.forEach(function (btn) {
      btn.addEventListener("click", function () {
        var filter = this.getAttribute("data-filter");

        // toggle active class
        buttons.forEach(function (b) { b.classList.remove("active"); });
        this.classList.add("active");

        rows.forEach(function (row) {
          if (filter === "all") {
            row.style.display = "";
          } else {
            row.style.display =
              row.getAttribute("data-status") === filter ? "" : "none";
          }
        });
      });
    });
  });
</script>
